!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).$$TEA=e()}(this,function(){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};function e(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&(n[i[o]]=t[i[o]])}return n}var o,r=void 0,s=function(){return{user:{user_id:r,web_id:r,user_unique_id:r,ssid:r,user_type:r},header:{app_id:r,app_name:r,os_name:r,os_version:r,device_model:r,ab_client:r,ab_version:r,ab_sdk_version:r,traffic_type:r,utm_source:r,utm_medium:r,utm_campaign:r,_sdk_version:r,_sdk_name:r,headers:{platform:r,sdk_version:r,browser:r,browser_version:r,region:r,province:r,city:r,language:r,timezone:r,tz_offset:r,resolution:r,screen_height:r,screen_width:r,referrer:r,referrer_host:r,custom:{}}}}},a="__tea_cache_";o={cn:"https://mcs.ctobsnssdk.com",va:"https://mcs.itobsnssdk.com",sg:"https://mcs.tobsnssdk.com"};var u,p={cn:"https://dpprofile.snssdk.com",sg:"https://sgali-dpprofile.byteoversea.com",va:"https://vaali-dpprofile.byteoversea.com"},c=1,f="cn",h=5e3,d=5,_=-1,l=!1,y=!1,g="cn",v=!1,m=!1,k="",b=!1,w=!1,x=function(t){function n(){var e=t.call(this)||this;return e._hooks={},e}return e(n,t),n.prototype.on=function(t,e){t&&e&&"function"==typeof e&&(this._hooks[t]||(this._hooks[t]=[]),this._hooks[t].push(e))},n.prototype.once=function(t,e){var n=this;if(t&&e&&"function"==typeof e){var i=function(o){e(o),n.off(t,i)};this.on(t,i)}},n.prototype.off=function(t,e){t&&this._hooks[t]&&this._hooks[t].length&&(e?this._hooks[t].splice(this._hooks[t].indexOf(e),1):this._hooks[t]=[])},n.prototype.emit=function(t,e){t&&this._hooks[t]&&this._hooks[t].length&&this._hooks[t].slice().forEach(function(t){try{t(e)}catch(t){}})},n}(function(){function t(){this._pluginInstances=[],this._listeners={},this._pluginInstances=[],this._keyPrefix=a,this._inited=!1,this._sended=!1,this._tokenOK=!1,this._whiteOK=!1,this._options={report_domain:c,report_channel:f,report_interval:h,max_batch_event:d,max_storage_num:_,auto_report:l,auto_profile:y,profile_channel:g,disable_storage:v,enable_ab_test:m,channel_domain:k,enable_et_test:b,enable_filter_list:w},this._envInfo=s(),this._ready=!1,this._extraData={},this.storage=new(this._get("storage")),this.logger=new(this._get("logger")),this.request=this._get("request"),this._initPlugin(),this._process()}return t.use=function(e,n){void 0===n&&(n={type:"plugin"});var i=n.name,o=n.type;if("plugin"===o)if(i){for(var r=!1,s=0,a=t.plugins.length;s<a;s++){var u=t.plugins[s];u.name&&u.name===i&&(r=!0,t.plugins[s].plugin=e)}r||t.plugins.push({name:i,plugin:e})}else t.plugins.push({plugin:e});else"adapter"===o&&(t.adapters[i]=e(t,n))},t.prototype._initPlugin=function(){var e=this;try{t.plugins.reduce(function(t,n){var i=n.plugin;return t.push(new i(e)),t},this._pluginInstances)}catch(t){}},t.prototype._on=function(t,e){t&&e&&"function"==typeof e&&(this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e))},t.prototype._once=function(t,e){var n=this;if(t&&e&&"function"==typeof e){var i=function(o,r){e(o,r),n._off(t,i)};this._on(t,i)}},t.prototype._emit=function(t,e){var n=this;"report"!==t&&(void 0===e?this.logger.info("触发"+t):this.logger.info("触发"+t+"：",e));var i=this._listeners[t];if(i&&i.length)try{i.slice().forEach(function(t){return t(n,e)})}catch(t){}},t.prototype._off=function(t,e){t&&this._listeners[t]&&this._listeners.length&&(e?this._listeners[t].splice(this._listeners[t].indexOf(e),1):this._listeners[t]=[])},t.prototype._get=function(e){return t.adapters[e]},Object.defineProperty(t.prototype,"appId",{get:function(){return this._appId},set:function(t){if("number"!=typeof t)throw new Error("app_id must be a number");this._appId=t},enumerable:!0,configurable:!0}),t.prototype._mergeEnv=function(t){!function(t,e){Object.keys(e).forEach(function(i){if("evtParams"===i)t.evtParams=n({},t.evtParams||{},e.evtParams||{});else if("_staging_flag"===i)t.evtParams=n({},t.evtParams||{},{_staging_flag:e._staging_flag});else{var o=e[i];"os_version"===i&&(o=""+o);var r=t.user,s=t.header,a=s.headers,u=a.custom;r.hasOwnProperty(i)?"user_type"===i?r[i]=Number(o):"user_id"===i?(r[i]=String(o),r.user_unique_id=String(o)):r[i]=String(o):s.hasOwnProperty(i)?s[i]=o:a.hasOwnProperty(i)?a[i]=o:u[i]=o}})}(this._envInfo,t)},t.prototype._setExtraData=function(t,e){this._extraData[t]=e},t.prototype._getExtraData=function(t){return void 0===t&&(t=""),t?this._extraData[t]:this._extraData},t.prototype.destroy=function(){this._pluginInstances.forEach(function(t){return t.destroy()})},t.prototype._process=function(){var t=this;this._emit("instantiation"),this._once("init",function(){t._mergeEnv({app_id:t.appId}),t._options.auto_report&&t._emit("auto-report"),t._options.enable_ab_test&&t._emit("ab-test"),t._options.enable_filter_list&&t._emit("fetch-white"),t._on("token-status",function(e,i){if(!i&&t._tokenOK&&t._emit("stop-report"),t._tokenOK=!!i,t._tokenOK){var o=t._envInfo.user;t._emit("token-ok",n({},o))}}),t._compose([t._tokenMiddleware.bind(t),t._sendMiddleware.bind(t),t._whiteMiddleware.bind(t),function(){return t._emit("start-report")}])(),t._emit("device"),t._emit("fetch-token"),t._once("fetch-token-complete",function(e,n){n?t._emit("token-status",!0):(t._emit("fetch-webid"),t._once("fetch-webid-complete",function(e,n){if(n){var i=t._envInfo.user,o=i.user_unique_id,r=i.web_id;o?t._emit("fetch-ssid",{user_unique_id:o,web_id:r}):(t._envInfo.user.user_unique_id=r,t._emit("token-status",!0))}}))}),t._on("config",function(e,n){var o=n.user_unique_id,r=i(n,["user_unique_id"]);if(t._mergeEnv(r),void 0!==o){o=""+o;var s=t._envInfo.user;s.web_id&&s.user_unique_id!==o?(s.user_unique_id=o,t._emit("token-status",!1),t._emit("fetch-ssid",{user_unique_id:o,web_id:s.web_id})):s.web_id||(s.user_unique_id=o)}}),t._on("fetch-ssid-complete",function(e,n){2===n.status&&t._emit("token-status",!0)})})},t.prototype._tokenMiddleware=function(t){this._tokenOK?t():this._once("token-ok",function(){t()})},t.prototype._sendMiddleware=function(t){this._sended?t():this._once("send",function(){t()})},t.prototype._whiteMiddleware=function(t){this._options.enable_filter_list?this._whiteOK?t():this._once("fetch-white-complete",function(){t()}):t()},t.prototype._compose=function(t){return t.reverse().reduce(function(t,e){return function(){return e(function(){return t()})}})},t.adapters={},t.plugins=[],t}()),S=function(){function t(t){this.sdk=t,this.apply()}return t.prototype.getUrl=function(t){var e=this.sdk._options,n=e.channel_domain,i="";if(n)i=n;else{var r=e.report_channel;Object.keys(o).includes(r)||(r=f),i=o[r]}switch(t){case"report":return i+"/v2/event/list";case"webid":return i+"/v2/user/webid";case"ssid":return i+"/v2/user/ssid"}},t.prototype.destroy=function(){this.sdk=null},t}(),O=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.apply=function(){var t=this;this.maxExpire=7344e6,this.minUpdateTime=432e7,this.sdk._on("fetch-token",function(e){t.fetchCacheToken(function(e){return setTimeout(function(){return t.sdk._emit("fetch-token-complete",e)})})}),this.sdk._on("fetch-webid",function(e){t.requestWebid(function(e){return t.sdk._emit("fetch-webid-complete",e)})}),this.sdk._on("fetch-ssid",function(e,n){t.requestSsid(n,function(e){return t.sdk._emit("fetch-ssid-complete",e)})})},i.prototype.fetchCacheToken=function(t){var e=this.sdk.storage,n=this.getKey(),i=e.get(n);i?this._hasCacheToken(t,i):t(!1)},i.prototype._hasCacheToken=function(t,e){var i=this,o=e;if("string"==typeof o)try{o=JSON.parse(o)}catch(t){}var r=o.user_unique_id,s=o.web_id,a=o.ssid,u=o.timestamp;if(s&&r&&u){var p=+new Date-parseFloat(u);if(p>=this.maxExpire)t(!1);else{var c=function(){i.sdk.emit("fetch-token",n({},o));var e=i.sdk._envInfo.user;e.user_unique_id=r,e.web_id=s,e.ssid=a,t(!0)};p>=this.minUpdateTime?this._updateWebid(s,function(e){e?c():t(!1)}):c()}}else t(!1)},i.prototype.requestWebid=function(t){var e=this,n=this.sdk.appId;this.sdk.request({url:this.getUrl("webid"),method:"POST",data:{app_id:n,url:"-",user_agent:"-",referer:"-",user_unique_id:""},header:{"Content-Type":"application/json; charset=utf-8"},success:function(n){var i=n.data;0!==i.e?t(!1):e._hasWebid(t,i)},fail:function(){t(!1)}})},i.prototype._hasWebid=function(t,e){var i=e.web_id,o=e.ssid,r=this.sdk._envInfo.user;r.web_id=i,r.ssid=o,this.sdk.storage.set(this.getKey(),n({},r,{user_unique_id:i,timestamp:+new Date})),t(!0)},i.prototype._updateWebid=function(t,e){var n=this,i=this.sdk.appId;this.sdk.request({url:this.getUrl("webid")+"/"+t+"/update",method:"POST",data:{app_id:i,url:"-",user_agent:"-",referer:"-",user_unique_id:""},header:{"Content-Type":"application/json; charset=utf-8"},success:function(t){0!==t.data.e?e(!1):n._hasUpdateWebid(e)},fail:function(){e(!1)}})},i.prototype._hasUpdateWebid=function(t){var e=this.sdk.storage,i=this.getKey(),o=e.get(i);e.set(i,n({},o||{},{timestamp:+new Date})),t(!0)},i.prototype.requestSsid=function(t,e){var n=this,i=this.sdk.appId,o=this.sdk._envInfo.user,r=function(n){return e({status:n,info:t})};this.sdk.request({url:this.getUrl("ssid"),method:"POST",data:{app_id:i,web_id:t.web_id,user_unique_id:""+t.user_unique_id},header:{"Content-Type":"application/json; charset=utf-8"},success:function(e){if(t.user_unique_id===o.user_unique_id){var i=e.data;0!==i.e?r(1):n._hasSsid(r,t,i)}else r(0)},fail:function(){t.user_unique_id===o.user_unique_id?r(1):r(0)}})},i.prototype._hasSsid=function(t,e,i){var o=this.sdk.storage,r=this.sdk._envInfo.user,s=i.ssid;r.web_id=e.web_id,r.ssid=s;var a=this.getKey(),u=(o.get(a)||{}).timestamp,p=void 0===u?+new Date:u;o.set(a,n({},r,{timestamp:p})),t(2)},i.prototype.getKey=function(){var t=this.sdk,e=t.appId;return t._keyPrefix+"tokens_"+e},i}(S),q=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.apply=function(){var t=this;this.cache=[],this.time=100,this.delaying=0,this.sdk._once("init",function(e){t._transformOldKey()}),this.sdk._on("event",function(e,n){t.event(n)})},n.prototype._transformOldKey=function(){var t=this.sdk.storage,e=this.getKey(!0);try{var n=t.get(e);if(n){var i=this.getKey(),o=t.get(i)||[];t.set(i,n.concat(o)),t.remove(e)}}catch(t){}finally{t.remove(e)}},n.prototype.event=function(t){var e=this;this.cache.push(t),this.delaying>0&&clearTimeout(this.delaying),this.delaying=setTimeout(function(){var t=e.cache.slice();e.cache=[],e.delaying=0,e.sync(t)},this.time)},n.prototype.sync=function(t){var e=this.sdk,n=e._ready,i=e.storage,o=e._options.max_batch_event,r=this.getKey(),s=i.get(r),a=(s||[]).concat(t);i.set(r,a),n&&o&&a.length>=o&&(this.sdk._emit("interval-report"),this.sdk._emit("report"))},n.prototype.getKey=function(t){void 0===t&&(t=!1);var e=this.sdk,n=e.appId,i=e._keyPrefix;return t?i+"events":i+"events_"+n},n}(S),I=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.apply=function(){var t=this;this.extOptions={},this.reporting=!1,this.time=3e3,this.splitNumber=3,this.splitTime=2e3,this.intervalIng=0,this.sdk._once("report-option",function(e,n){t.extOptions=n}),this.sdk._once("init",function(e){t._reissue()}),this.sdk._on("start-report",function(e){t.sdk._ready=!0,t.interval(),t.report()}),this.sdk._on("report",function(e,n){t.report(n)}),this.sdk._on("immediate-report",function(e,n){t.immediateReport(n)}),this.sdk._on("immediate-report-batch",function(e,n){t.immediateReportBatch(n)}),this.sdk._on("stop-report",function(){t.sdk._ready=!1,t.stop()}),this.sdk._on("interval-report",function(){t.interval()})},i.prototype._reissue=function(){try{var t=this.sdk.storage,e=this.getKey("reports"),n=t.get(e);n&&this._reissueProcess(n)}catch(t){}},i.prototype._reissueProcess=function(t){var e=this,n=Object.keys(t),i=function(){if(n.length){for(var o=[],r=0;r<e.splitNumber;r++)n.length&&o.push(n.shift());o.length&&o.forEach(function(n){e.post(t[n],n)}),setTimeout(i,e.splitTime)}};i()},i.prototype.interval=function(){var t=this,e=this.sdk._options.report_interval;this.stop(),this.intervalIng=setTimeout(function(){t.sdk._emit("report"),t.intervalIng=0,t.interval()},e)},i.prototype.stop=function(){this.intervalIng>0&&clearTimeout(this.intervalIng),this.intervalIng=0},i.prototype.report=function(t){var e=this.sdk.storage,n=this.getKey("events"),i=e.get(n);if(i&&i.length){e.remove(n);var o=this.sdk._options.max_storage_num;if(o>0){var r=this.getKey("reports"),s=e.get(r)||{},a=Object.keys(s);if(a.length>=o){var u=a.sort(function(t,e){var n=t.split(".")[0],i=e.split(".")[0];return parseFloat(n)-parseFloat(i)});u&&u[0]&&this.removeReport(u[0])}}var p=this.mergeEvent(i);this.post(p)}},i.prototype.immediateReport=function(t){var e=this.mergeEvent([t]),n=this.getRandom();this.doPost(e,n,function(t){})},i.prototype.immediateReportBatch=function(t){var e=this.mergeEvent(t),n=this.getRandom();this.doPost(e,n,function(t){})},i.prototype.mergeEvent=function(t){var e=this.sdk._envInfo,n=e.user,i=e.header,o=e.evtParams,r=t.map(function(t){return o&&Object.keys(o).forEach(function(e){void 0===t.params[e]&&(t.params[e]=o[e])}),t.params=JSON.stringify(t.params),t}),s=JSON.parse(JSON.stringify({events:r,user:n,header:i}));return s.header.headers&&(s.header.headers=JSON.stringify(s.header.headers)),[s]},i.prototype.post=function(t,e){var i,o=this,r="";if(e)r=e;else{var s=this.sdk.storage,a=this.getKey("reports"),u=s.get(a)||{};r=this.getRandom(),s.set(a,n({},u||{},((i={})[r]=t,i)))}this.doPost(t,r,function(t){2!==t&&1!==t||o.removeReport(r)})},i.prototype.doPost=function(t,e,i){this.sdk._options.enable_et_test&&this.sdk.request({url:"https://data.bytedance.net/et_api/logview/web_verify/?from=weex",method:"POST",data:t});var o=this.extOptions,r=o.dataType,s=o.header,a=o.method;this.sdk.request({url:this.getUrl("report")+"?tea_sdk_random="+e,method:a||"POST",dataType:r,data:t,header:n({"Content-Type":"application/json; charset=utf-8"},s||{}),success:function(t){0!==t.data.e?i(1):i(2)},fail:function(){i(0)}})},i.prototype.getKey=function(t){var e=this.sdk,n=e.appId;return""+e._keyPrefix+t+"_"+n},i.prototype.getRandom=function(){return+new Date+"."+Math.floor(1e5*Math.random())},i.prototype.removeReport=function(t){try{var e=this.sdk.storage,n=this.getKey("reports"),i=e.get(n);i&&i[t]&&(i=Object.keys(i).reduce(function(e,n){return n!==t&&(e[n]=i[n]),e},{})),e.set(n,i)}catch(t){}},i.prototype.destroy=function(){this.stop(),t.prototype.destroy.call(this)},i}(S);!function(t){t.Normal="synchronize",t.Once="setOnce"}(u||(u={}));var E,P,T=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.apply=function(){var t=this;this.autoId=0,this.lastId=0,this.lastOnceId=0,this.duration=1e4,this.data=null,this.autoStatus=!1,this.sdk._once("init",function(e){var n,i=t.sdk._options,o=i.auto_profile,r=i.profile_channel;t.channel=r,t.urls=((n={})[u.Normal]=t.getProfileUrl(u.Normal),n[u.Once]=t.getProfileUrl(u.Once),n),t.autoStatus=!!o,t.autoStatus&&t.sdk._once("start-report",function(){t.start()})}),this.sdk._on("profile-info",function(e,n){t.sdk._mergeEnv(n)}),this.sdk._on("profile",function(e,n){t.autoStatus&&t.setProfile(n)}),this.sdk._on("profile-once",function(e,n){t.autoStatus&&t.setOnceProfile(n)})},o.prototype.getProfileUrl=function(t){return p[this.channel]+"/service/api/v3/userprofile/"+this.sdk.appId+"/"+t},o.prototype.getData=function(t){void 0===t&&(t={});var e=JSON.parse(JSON.stringify(this.sdk._envInfo)),o=e.user,r=e.header,s=r.headers,a=r.otherHeader,u=s.custom,p=i(s,["custom"]);return{user:{web_id:o.web_id,ssid:o.ssid,user_unique_id:o.user_unique_id},header:n({},a||{},p||{}),profile:n({},u||{},t||{})}},o.prototype.start=function(){var t=this;this.autoId>0||(this.upPre(u.Normal),this.autoId=setInterval(function(){t.upPre(u.Normal)},this.duration))},o.prototype.stop=function(){this.autoId>0&&clearInterval(this.autoId)},o.prototype.setProfile=function(t){var e=+new Date;(!this.lastId||e-this.lastId>=this.duration)&&(this.sdk._mergeEnv(t),this.upPre(u.Normal,t),this.lastId=e)},o.prototype.setOnceProfile=function(t){var e=+new Date;(!this.lastOnceId||e-this.lastOnceId>=this.duration)&&(this.sdk._mergeEnv(t),this.upPre(u.Once,t),this.lastOnceId=e)},o.prototype.upPre=function(t,e){void 0===e&&(e={});var n=this.getData(e);this.data&&JSON.stringify(this.data)===JSON.stringify(n)||(this.up(this.urls[t],n),this.data=n)},o.prototype.up=function(t,e){this.profile(t,e)},o.prototype.profile=function(t,e,n){void 0===n&&(n=function(t){}),this.sdk.request({url:t,method:"POST",data:e,header:{"Content-Type":"application/json; charset=utf-8"},success:function(t){0!==t.data.e?n(1):n(2)},fail:function(){n(0)}})},o.prototype.destroy=function(){this.stop(),t.prototype.destroy.call(this)},o}(S),C={cn:"https://toblog.ctobsnssdk.com",va:"https://toblog.itobsnssdk.com",sg:"https://toblog.tobsnssdk.com"};!function(t){t[t.No=0]="No",t[t.Ing=1]="Ing",t[t.Complete=2]="Complete"}(E||(E={})),function(t){t[t.Var=0]="Var",t[t.All=1]="All"}(P||(P={}));var D=function(t){console.log(t)},N=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.apply=function(){var t=this;this.sdk._once("ab-test",function(){var e=t.sdk,o=e.appId,r=e._options.report_channel,s=e._envInfo;t.appId=o,t.domain=C[r],t.fetchStatus=E.No,t.callbacks=[],t.data=null,t.versions=[],t.sdk._once("start-report",function(){var e=s.user,o=s.header,r=o.headers,a=i(o,["headers"]);t.user=n({},e),t._fetch(n({},a,r))}),t._check(),t.sdk._once("ab-var",function(e,n){var i=n.name,o=n.defaultValue,r=n.callback;t.getVar(i,o,r)}),t.sdk._once("ab-allvars",function(e,n){t.getAllVars(n)})})},o.prototype.getAllVars=function(t){if("function"!=typeof t)return D("回调函数必须为一个函数");var e={callback:t,type:P.All};this.fetchStatus===E.Complete?this._getAllVars(e):this.callbacks.push(e)},o.prototype.getVar=function(t,e,n){if(!t)return D("变量名不能为空");if(void 0===e)return D("变量没有默认值");if("function"!=typeof n)return D("回调函数必须为一个函数");var i={name:t,defaultValue:e,callback:n,type:P.Var};this.fetchStatus===E.Complete?(this._getVar(i),this._updateVersions()):this.callbacks.push(i)},o.prototype._check=function(){var t=this,e=this._checkExpiration(this.appId);if(e){var n=e.ab_version,i=e.data;n&&n.length&&(this.versions=n,this.data=i,setTimeout(function(){t._configVersions()}))}},o.prototype._fetchComplete=function(t){var e=this;if(t){this._setDataCache(this.appId,t),this.data=t;var n=[];Object.keys(t).forEach(function(e){var i=t[e].vid;i&&n.push(i)}),this.versions=this.versions.filter(function(t){return n.includes(t)})}this.callbacks.forEach(function(t){return e[t.type===P.Var?"_getVar":"_getAllVars"](t)}),this.callbacks=[],this._updateVersions()},o.prototype._getAllVars=function(t){(0,t.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{})},o.prototype._getVar=function(t){var e=t.name,n=t.defaultValue,i=t.callback,o=this.data;if(o)if("object"==typeof o[e]&&void 0!==o[e].val){i(o[e].val);var r=o[e].vid;this.versions.includes(r)||this.versions.push(r)}else i(n);else i(n)},o.prototype._updateVersions=function(){this._setVersionCache(this.appId,this.versions),this._configVersions()},o.prototype._configVersions=function(){var t=this.versions.join(",");t&&this.sdk._mergeEnv({ab_sdk_version:t})},o.prototype._url=function(){return this.domain+"/service/2/abtest_config/"},o.prototype._fetch=function(t,e){var i=this,o=void 0===e?{}:e,r=o.success,s=void 0===r?function(){}:r,a=o.fail,u=void 0===a?function(){}:a;this.fetchStatus=E.Ing;var p=this._url();this.sdk.request({url:p,data:{header:n({aid:this.appId},this.user||{},t||{})},method:"POST",header:{"Content-Type":"application/json; charset=utf-8"},success:function(t){void 0===t&&(t={}),i.fetchStatus=E.Complete;var e=(t||{}).data,n=(void 0===e?{}:e).data,o=void 0===n?{}:n;o?(i._fetchComplete(o),s(o)):(i._fetchComplete(null),u())},fail:function(){i.fetchStatus=E.Complete,u(),i._fetchComplete(null)}})},o.prototype._getStorageKey=function(t){return"__tea_sdk_ab_version_"+t},o.prototype._getCache=function(t){var e=this.sdk.storage,n={ab_version:[],data:null,timestamp:+new Date};try{n=e.get(this._getStorageKey(t))||n}catch(t){}return n},o.prototype._setCache=function(t,e){var i=this.sdk.storage;try{var o=this._getCache(t);i.set(this._getStorageKey(t),n({},o,e))}catch(t){}},o.prototype._setVersionCache=function(t,e){this._setCache(t,{ab_version:e,timestamp:+new Date})},o.prototype._setDataCache=function(t,e){this._setCache(t,{data:e})},o.prototype._checkExpiration=function(t){var e=this.sdk.storage,n=this._getCache(t),i=n.timestamp;if(+new Date-i>=2592e6){try{e.remove("__tea_sdk_ab_version")}catch(t){}return null}return n},o}(S),V=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.apply=function(){var t=this;this.cache=[],this.expire=21600,this.timeout=5e3,this.sdk._once("fetch-white",function(e){t.initWhite(function(){t.sdk._whiteOK=!0,t.sdk._emit("fetch-white-complete")})})},n.prototype.initWhite=function(t){var e=this,n=this.sdk.storage,i=this.getKey(),o=n.get(i);if(o&&o.timestamp&&(this.sdk._setExtraData("white",o.data),(o.interval||this.expire)+o.timestamp<=+new Date))return void t();this._requestWhite(function(o,r){o&&(e.sdk._setExtraData("white",r.event_list),n.set(i,{timestamp:+new Date,interval:r.fetch_interval||e.expire,data:r.event_list})),t()})},n.prototype._requestWhite=function(t){setTimeout(function(){t(!0,{event_list:{is_black:0,events:["app_launch","xxx1","xxx2"],params:{xxx3:["xxx"]}},fetch_interval:3600})},3e3)},n.prototype.requestWhite=function(t){var e=this.sdk.appId;this.sdk.request({url:"",method:"POST",data:{app_id:e},header:{"Content-Type":"application/json; charset=utf-8"},timeout:5e3,success:function(e){var n=e.data;0!==n.e?t(!1,null):t(!0,n)},fail:function(){t(!1,null)}})},n.prototype.getKey=function(){var t=this.sdk,e=t.appId;return t._keyPrefix+"white_"+e},n}(S),j=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.getConfig=function(){return JSON.parse(JSON.stringify(this._envInfo))},i.prototype.init=function(t){if(!this._inited){if(this._inited=!0,"object"==typeof t){if(this.appId=t.app_id,void 0===t.report_channel&&void 0!==t.report_domain){var e=t.report_domain;e=parseInt(String(e),10),[1,2].includes(e)||(e=1),t.report_channel=1===e?"cn":"sg"}void 0!==t.channel&&(t.report_channel=t.channel),this._options=n({},this._options,t)}else this.appId=t;this._emit("init")}},i.prototype.config=function(t){this._inited&&(t=n({},t),this._emit("before-config",t),void 0!==t.log&&(this.logger.setEnable(t.log),delete t.log),this._emit("config",t))},i.prototype.send=function(){this._inited&&(this._sended=!0,this._emit("send"))},i.prototype._filterEvent=function(t){var e=t.current,i=t.isBlack,o=t.eventNames,r=t.eventParams,s=t.whiteEvents,a=e.event,u=e.params;if(s.includes(a))return e;if(i){if(o.includes(a))return null;if(r[a]&&Array.isArray(r[a]))return n({},e,{params:Object.keys(u).filter(function(t){return!r[a].includes(t)}).reduce(function(t,e){return t[e]=u[e],t},{})})}else{if(!o.includes(a))return null;if(r[a]&&Array.isArray(r[a]))return n({},e,{params:Object.keys(u).filter(function(t){return r[a].includes(t)}).reduce(function(t,e){return t[e]=u[e],t},{})})}return e},i.prototype._event=function(t,e){var n=this,i=["immediate-report-batch","immediate-report"].includes(t);this._compose((i?[this._tokenMiddleware.bind(this)]:[]).concat([this._whiteMiddleware.bind(this),function(){if(n._options.enable_filter_list){var i=n._getExtraData("white");if(i&&void 0!==i.is_black){var o,r=n._getExtraData("white-events"),s=i||{},a=s.is_black,u=void 0===a?1:a,p=s.events,c=void 0===p?[]:p,f=s.params,h=void 0===f?{}:f;if(Array.isArray(e))(o=e.reduce(function(t,e){var i=n._filterEvent({current:e,isBlack:u,eventNames:c,eventParams:h,whiteEvents:r});return null!==i&&t.push(i),t},[])).length&&n._emit(t,o);else null!==(o=n._filterEvent({current:e,isBlack:u,eventNames:c,eventParams:h,whiteEvents:r}))&&n._emit(t,o)}else n._emit(t,e)}else n._emit(t,e)}]))()},i.prototype.event=function(t,e,i){void 0===e&&(e={}),void 0===i&&(i=!1);var o=this._getExtraData("session_id");if(Array.isArray(t)){if(t.length>30){for(;this.event(t.splice(0,30)),0!==t.length;);return}var r=[],s=+new Date,a=function(t,e,i){if(t&&"string"==typeof t){var a=i;(!a||"number"!=typeof a||a>s)&&(a=s),r.push(n({event:t,params:e||{}},o?{session_id:o}:{},{local_time_ms:a}))}};return t.forEach(function(t){if(Array.isArray(t)){var e=t[0],n=t[1],i=t[2];a(e,n,i)}else{var o=t.event,r=t.params;i=t.local_time_ms;a(o,r,i)}}),void(r.length&&this._event("immediate-report-batch",r))}var u=n({event:t,params:e||{}},o?{session_id:o}:{},{local_time_ms:+new Date}),p=this._options.disable_storage;i||p?this._event("immediate-report",u):this._event("event",u)},i.prototype.setProfile=function(t){this._emit("profile",t)},i.prototype.setOnceProfile=function(t){this._emit("profile-once",t)},i.prototype.getVar=function(t,e,n){this._emit("ab-var",{name:t,defaultValue:e,callback:n})},i.prototype.getAllVars=function(t){this._emit("ab-allvars",t)},i.prototype.getToken=function(t){var e=this,i=function(){var i=e._envInfo.user;return t(n({},i))};this._tokenOK?i():this._once("token-ok",function(){i()})},i}(x);j.use(O,{name:"token",type:"plugin"}),j.use(q,{name:"event",type:"plugin"}),j.use(I,{name:"report",type:"plugin"}),j.use(T,{name:"profile",type:"plugin"}),j.use(N,{name:"ab",type:"plugin"}),j.use(V,{name:"white",type:"plugin"});var K=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.apply=function(){var t=this;this.sdk._on("device",function(t){if("undefined"!=typeof qg)qg.getSystemInfo&&qg.getSystemInfo({success:function(e){var n={platform:"quickGame",brand:e.brand,device_model:e.model,pixelRatio:e.pixelRatio,resolution:e.screenWidth+"x"+e.screenHeight,screen_width:e.screenWidth,screen_height:e.screenHeight,windowWidth:e.windowWidth,windowHeight:e.windowHeight,os_version:e.system||e.osVersionName,os_name:e.platform||e.platformVersionName,os_platform_version:e.platformVersion||e.platformVersionCode,SDKVersion:e.COREVersion,fontSizeSetting:e.fontSizeSetting,language:e.language};t._mergeEnv(n)}}),qg.getNetworkType&&qg.getNetworkType({success:function(e){var n={networkType:e.networkType};t._mergeEnv(n)}});else if("undefined"!=typeof wx||"undefined"!=typeof qq){var e=wx||qq;e.getSystemInfo&&e.getSystemInfo({success:function(e){var n={platform:"quickGame",brand:e.brand,device_model:e.model,pixelRatio:e.pixelRatio,resolution:e.screenWidth+"x"+e.screenHeight,screen_width:e.screenWidth,screen_height:e.screenHeight,windowWidth:e.windowWidth,windowHeight:e.windowHeight,wx_version:e.version,os_version:e.system,os_name:e.platform,SDKVersion:e.SDKVersion,fontSizeSetting:e.fontSizeSetting,language:e.language};t._mergeEnv(n);var i={mp_platform:0,mp_platform_app_version:e.version,mp_platform_basic_version:e.SDKVersion};t._mergeEnv(i)}}),e.getNetworkType&&wx.getNetworkType({success:function(e){var n={networkType:e.networkType};t._mergeEnv(n)}})}else"undefined"!=typeof tt&&(tt.getSystemInfo&&tt.getSystemInfo({success:function(e){var n={platform:"quickGame",brand:e.brand,device_model:e.model,pixelRatio:e.pixelRatio,resolution:e.screenWidth+"x"+e.screenHeight,screen_width:e.screenWidth,screen_height:e.screenHeight,windowWidth:e.windowWidth,windowHeight:e.windowHeight,wx_version:e.version,os_version:e.system,os_name:e.platform,SDKVersion:e.SDKVersion,fontSizeSetting:e.fontSizeSetting,language:e.language};t._mergeEnv(n);var i={mp_platform:0,mp_platform_app_version:e.version,mp_platform_basic_version:e.SDKVersion};t._mergeEnv(i)}}),tt.getNetworkType&&tt.getNetworkType({success:function(e){var n={networkType:e.networkType};t._mergeEnv(n)}}))}),this.sdk._on("init",function(e){t.sdk._emit("report-option",{dataType:"json",header:{"content-type":"application/json"}})})},n}(S),A=function(t,e){t.logger.info("参数类型不匹配，参数及类型需要如下："+e)},W={gtAdButtonClick:"gt_ad_button_click",gtAdShow:"gt_ad_show",gtAdShowEnd:"gt_ad_show_end",gtLevelup:"gt_levelup",gtStartPlay:"gt_start_play",gtEndPlay:"gt_end_play",gtGetCoins:"gt_get_coins",gtCostCoins:"gt_cost_coins",gtPurchase:"purchase",gtInitInfo:"gt_init_info"},J=Object.freeze({Events:W,gtAdButtonClick:function(t,e,i){"string"==typeof i.ad_type&&"string"==typeof i.ad_position_type&&"string"==typeof i.ad_position?e(W.gtAdButtonClick,n({},i)):A(t,"\n      ad_type: string;\n      ad_position_type: string;\n      ad_position: string;\n    ")},gtAdShow:function(t,e,i){"string"==typeof i.ad_type&&"string"==typeof i.ad_position_type&&"string"==typeof i.ad_position?e(W.gtAdShow,n({},i)):A(t,"\n      ad_type: string;\n      ad_position_type: string;\n      ad_position: string;\n    ")},gtAdShowEnd:function(t,e,i){"string"==typeof i.ad_type&&"string"==typeof i.ad_position_type&&"string"==typeof i.ad_position&&"string"==typeof i.result?e(W.gtAdShowEnd,n({},i)):A(t,"\n      ad_type: string;\n      ad_position_type: string;\n      ad_position: string;\n      result: string;\n    ")},gtLevelup:function(t,e,i){"number"==typeof i.get_exp&&"string"==typeof i.method&&"number"==typeof i.aflev&&"number"==typeof i.lev?e(W.gtLevelup,n({},i)):A(t,"\n      get_exp: number;\n      method: string;\n      aflev: number;\n      lev: number;\n    ")},gtStartPlay:function(t,e,i){"string"==typeof i.ectype_name?e(W.gtStartPlay,n({},i)):A(t,"\n      ectype_name: string;\n    ")},gtEndPlay:function(t,e,i){"string"==typeof i.ectype_name&&"string"==typeof i.result&&"number"==typeof i.duration?e(W.gtEndPlay,n({},i)):A(t,"\n      ectype_name: string;\n      result: string;\n      duration: number;\n    ")},gtGetCoins:function(t,e,i){"string"==typeof i.coin_type&&"string"==typeof i.method&&"number"==typeof i.coin_num?e(W.gtGetCoins,n({},i)):A(t,"\n      coin_type: string;\n      method: string;\n      coin_num: number;\n    ")},gtCostCoins:function(t,e,i){"string"==typeof i.coin_type&&"string"==typeof i.method&&"number"==typeof i.coin_num?e(W.gtCostCoins,n({},i)):A(t,"\n      coin_type: string;\n      method: string;\n      coin_num: number;\n    ")},gtPurchase:function(t,e,i){"string"==typeof i.content_id&&"string"==typeof i.content_name&&"number"==typeof i.content_num&&"string"==typeof i.content_type&&"string"==typeof i.currency&&"number"==typeof i.currency_amount&&"string"==typeof i.is_success&&"string"==typeof i.payment_channel?e(W.gtPurchase,n({},i)):A(t,"\n      content_id: string;\n      content_name: string;\n      content_num: number;\n      content_type: string;\n      currency: string;\n      currency_amount: number;\n      is_success: string;\n      payment_channel: string;\n    ")},gtInitInfo:function(t,e,i){"string"==typeof i.coin_type&&"number"==typeof i.coin_left&&"number"==typeof i.lev?e(W.gtInitInfo,n({},i)):A(t,"\n      coin_type: string;\n      coin_left: number;\n      lev: number;\n    ")}}),R=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.apply=function(){this.sdk._on("instantiation",function(t){var e=W,n=i(J,["Events"]),o=t._getExtraData("white-events");t._setExtraData("white-events",(o||[]).concat(Object.values(e))),Object.keys(n).forEach(function(e){t[e]=n[e].bind(null,t,t.event.bind(t))})})},n}(S),H=function(t){return function(){function e(){}return e.prototype.get=function(e){try{return t.getStorageSync(e)}catch(t){}},e.prototype.set=function(e,n){try{return t.setStorageSync(e,n),!0}catch(t){}return!1},e.prototype.remove=function(e){try{t.removeStorageSync(e)}catch(t){}},e}()},M="",U=function(){function t(t){this.enable=!0,this.console=t}return t.prototype.setEnable=function(t){this.enable=t},t.prototype.info=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enable&&(t=this.console).log.apply(t,e)},t.prototype.warn=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enable&&(t=this.console).warn.apply(t,e)},t.prototype.error=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enable&&(t=this.console).error.apply(t,e)},t}(),z=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},B={appOnShow:"app_launch",appOnHide:"app_terminate",appOnError:"on_error"},L=function(t,e){var i=z();e._setExtraData("session_id",i);var o=function(t){t()};if(void 0!==t){var r=function(t){i=z(),e._setExtraData("session_id",i),e._setExtraData("session_start",+new Date);o(function(){return function(t){var o;void 0!==t&&("string"==typeof t?o=t:"object"==typeof t&&void 0!==t.query&&(o=JSON.stringify(t.query))),e.event(B.appOnShow,n({session_id:i},o?{query:o}:{}),!0)}(t)})};t.onShow(r),e.appLaunch=function(){var e;void 0!==t.getLaunchOptionsSync&&(e=t.getLaunchOptionsSync()),r(e)};var s=function(){var t=e._getExtraData("session_start"),n=Math.ceil((+new Date-t)/1e3);o(function(){e.event(B.appOnHide,{session_duration:n},!0)})};t.onHide(s),e.appTerminate=function(){s()};var a=function(t){o(function(){e.event(B.appOnError,n({},t||{}),!0)})};t.onError(a),e.appError=function(t){a(t)}}},G=function(t){"undefined"!=typeof qg&&L(qg,t)},F=function(t){"undefined"!=typeof wx&&L(wx,t)},$=function(t){"undefined"!=typeof tt&&L(tt,t)},X=function(t){"undefined"!=typeof qq&&L(qq,t)},Q=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.apply=function(){var t=this.sdk;t._on("instantiation",function(t){var e=t._getExtraData("white-events");t._setExtraData("white-events",(e||[]).concat(Object.values(B)))});var e=function(t){};"undefined"!=typeof qg?e=G:"undefined"!=typeof wx?e=F:"undefined"!=typeof tt?e=$:"undefined"!=typeof qq&&(e=X),t._once("auto-report",e)},n}(S),Y=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.apply=function(){this.sdk._on("before-config",function(t,e){})},n}(S),Z=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.apply=function(){var t=this;this.sdk._on("instantiation",function(){t.sdk._mergeEnv({_sdk_version:"1.0.4",_sdk_name:"@dp/tea-sdk-qg".replace("@dp/tea-","")||"sdk-qg"})})},n}(S);return j.use(Q,{type:"plugin"}),j.use(K,{type:"plugin"}),j.use(R,{type:"plugin"}),j.use(Y,{type:"plugin"}),j.use(function(t,e){return"undefined"!=typeof qg?void 0!==qg.getStorageSync?function(){function t(){}return t.prototype.get=function(t){try{var e=qg.getStorageSync({key:t});return"object"==typeof e||void 0===e?e:"string"==typeof e?"key not define"===e.trim()?null:JSON.parse(e):e}catch(t){}},t.prototype.set=function(t,e){try{return qg.setStorageSync({key:t,value:JSON.stringify(e)}),!0}catch(t){}return!1},t.prototype.remove=function(t){try{qg.deleteStorageSync({key:t})}catch(t){}},t}():function(){function t(){}return t.prototype.get=function(t){try{var e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(t){}},t.prototype.set=function(t,e){try{return localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){}return!1},t.prototype.remove=function(t){try{localStorage.removeItem(t)}catch(t){}},t}():"undefined"!=typeof wx||"undefined"!=typeof qq?H(wx||qq):"undefined"!=typeof tt?H(tt):void 0},{name:"storage",type:"adapter"}),j.use(function(t,e){return function(t){if("undefined"!=typeof qg){if(void 0!==qg.request)return M||(M=qg.getSystemInfoSync().brand),"vivo"===M?void qg.request(n({},t,{dataType:"json",data:JSON.stringify(t.data)})):void qg.request(n({},t,{dataType:"json"}));var e=t.url,i=t.method,o=t.timeout,r=t.success,s=t.fail,a=t.data,u=new XMLHttpRequest;o&&(u.timeout=o),u.open(i,""+e,!0),u.setRequestHeader("Content-Type","application/json; charset=utf-8"),u.onload=function(){try{var t=JSON.parse(u.responseText);r&&r({data:t})}catch(t){s&&s()}},u.ontimeout=function(){s()},u.onerror=function(){u.abort(),s()},u.send(JSON.stringify(a))}else"undefined"!=typeof wx||"undefined"!=typeof qq?(wx||qq).request(n({},t)):"undefined"!=typeof tt&&tt.request(n({},t))}},{name:"request",type:"adapter"}),j.use(function(t,n){return function(t){function n(){return t.call(this,"undefined"!=typeof console?console:{log:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},warn:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},error:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}})||this}return e(n,t),n}(U)},{name:"logger",type:"adapter"}),j.use(Z,{type:"plugin"}),new j});
