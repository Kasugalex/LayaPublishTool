!function(t,e,i){{var n=(i.un,i.uns,i.static),h=i.class,r=i.getset,l=(i.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),s=laya.utils.ClassUtils,a=(laya.events.Event,laya.utils.HTMLChar),o=laya.net.Loader,d=(laya.display.Node,laya.maths.Rectangle),u=laya.renders.Render,c=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),f=laya.utils.Stat,_=laya.display.Text,g=laya.resource.Texture,y=laya.net.URL,p=laya.utils.Utils,m=function(){function t(){}return h(t,"laya.html.utils.HTMLParse"),t.parse=function(e,i,n){i=i.replace(/<br>/g,"<br/>"),i="<root>"+i+"</root>",i=i.replace(t.spacePattern,t.char255);var h=p.parseXMLFromString(i);t._parseXML(e,h.childNodes[0].childNodes,n)},t._parseXML=function(e,i,n,h){var r=0,l=0;if(i.join||i.item)for(r=0,l=i.length;l>r;++r)t._parseXML(e,i[r],n,h);else{var a,o;if(3==i.nodeType){var d;return e instanceof laya.html.dom.HTMLDivElement?(null==i.nodeName&&(i.nodeName="#text"),o=i.nodeName.toLowerCase(),d=i.textContent.replace(/^\s+|\s+$/g,""),d.length>0&&(a=s.getInstance(o),a&&(e.addChild(a),a.innerTEXT=d.replace(t.char255AndOneSpacePattern," ")))):(d=i.textContent.replace(/^\s+|\s+$/g,""),d.length>0&&(e.innerTEXT=d.replace(t.char255AndOneSpacePattern," "))),void 0}if(o=i.nodeName.toLowerCase(),"#comment"==o)return;if(a=s.getInstance(o)){a=e.addChild(a),a.URI=n,a.href=h;var u=i.attributes;if(u&&u.length>0)for(r=0,l=u.length;l>r;++r){var c=u[r],f=c.nodeName,_=c.value;a._setAttributes(f,_)}t._parseXML(a,i.childNodes,n,a.href)}else t._parseXML(e,i.childNodes,n,h)}},t.char255=String.fromCharCode(255),t.spacePattern=/&nbsp;|&#160;/g,t.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),t}(),w=function(){function t(){}return h(t,"laya.html.utils.Layout"),t.later=function(e){null==t._will&&(t._will=[],i.stage.frameLoop(1,null,function(){if(!(t._will.length<1)){for(var e=0;e<t._will.length;e++)laya.html.utils.Layout.layout(t._will[e]);t._will.length=0}})),t._will.push(e)},t.layout=function(e){if(!e||!e._style)return null;if(0===(512&e._style._type))return null;e.getStyle()._type&=-513;var i=t._multiLineLayout(e);return u.isConchApp&&e.layaoutCallNative&&e.layaoutCallNative(),i},t._multiLineLayout=function(e){function i(){A.y=C,C+=A.h+f,0==A.h&&(C+=g),A.mWidth=N,N=0,A=new x,H.push(A),A.h=0,T=0,W=!0,I=!1}if(_.RightToLeft)return t._multiLineLayout2(e);var n=new Array;e._addChildsToLayout(n);var h,r,l,s,a,o=0,d=n.length,u=e._getCSSStyle(),c=u.letterSpacing,f=u.leading,g=u.lineHeight,y=u._widthAuto()||!u.wordWrap,p=y?999999:e.width,m=(e.height,0),w=u.italic?u.fontSize/3:0,v=u._getAlign(),S=u._getValign(),L=0!==S||0!==v||0!=g,T=0,C=0,E=0,M=0,H=new Array,A=H[0]=new x,I=!1,R=!1;A.h=0,u.italic&&(p-=u.fontSize/3);var N=0,W=!0;for(o=0;d>o;o++)if(h=n[o],null!=h)if(W=!1,h instanceof laya.html.dom.HTMLBrElement)i(),A.y=C;else{if(h._isChar()){if(s=h,s.isWord)I=R||"\n"===s.char,A.wordStartIndex=A.elements.length;else{if(H.length>0&&T+E>p&&A.wordStartIndex>0){var U=0;U=A.elements.length-A.wordStartIndex+1,A.elements.length=A.wordStartIndex,o-=U,i();continue}I=!1,N+=s.width}E=s.width+c,M=s.height,R=!1,I=I||T+E>p,I&&i(),A.minTextHeight=Math.min(A.minTextHeight,h.height)}else r=h._getCSSStyle(),a=h,l=r.padding,0===r._getCssFloat()||(L=!0),I=R||r.lineElement,E=a.width*a._style._tf.scaleX+l[1]+l[3]+c,M=a.height*a._style._tf.scaleY+l[0]+l[2],R=r.lineElement,I=I||T+E>p&&r.wordWrap,I&&i();A.elements.push(h),A.h=Math.max(A.h,M),h.x=T,h.y=C,T+=E,A.w=T-c,A.y=C,m=Math.max(T+w,m)}else W||(T+=t.DIV_ELEMENT_PADDING),A.wordStartIndex=A.elements.length;if(C=A.y+A.h,L){var b=0,P=p;for(y&&e.width>0&&(P=e.width),o=0,d=H.length;d>o;o++)H[o].updatePos(0,P,o,b,v,S,g),b+=Math.max(g,H[o].h+f);C=b}return y&&(e.width=m),C>e.height&&(e.height=C),[m,C]},t._multiLineLayout2=function(e){function i(){H.y=T,T+=H.h+f,0==H.h&&(T+=_),H.mWidth=R,R=0,H=new x,M.push(H),H.h=0,L=0,N=!0,A=!1}var n=new Array;e._addChildsToLayout(n);var h,r,l,s,a,o=0,d=n.length,u=e._getCSSStyle(),c=u.letterSpacing,f=u.leading,_=u.lineHeight,g=u._widthAuto()||!u.wordWrap,y=g?999999:e.width,p=(e.height,0),m=u.italic?u.fontSize/3:0,w=2-u._getAlign(),v=u._getValign(),S=0!==v||0!==w||0!=_,L=0,T=0,C=0,E=0,M=new Array,H=M[0]=new x,A=!1,I=!1;H.h=0,u.italic&&(y-=u.fontSize/3);var R=0,N=!0;for(o=0;d>o;o++)if(h=n[o],null!=h)if(N=!1,h instanceof laya.html.dom.HTMLBrElement)i(),H.y=T;else{if(h._isChar()){if(s=h,s.isWord)A=I||"\n"===s.char,H.wordStartIndex=H.elements.length;else{if(M.length>0&&L+C>y&&H.wordStartIndex>0){var W=0;W=H.elements.length-H.wordStartIndex+1,H.elements.length=H.wordStartIndex,o-=W,i();continue}A=!1,R+=s.width}C=s.width+c,E=s.height,I=!1,A=A||L+C>y,A&&i(),H.minTextHeight=Math.min(H.minTextHeight,h.height)}else r=h._getCSSStyle(),a=h,l=r.padding,0===r._getCssFloat()||(S=!0),A=I||r.lineElement,C=a.width*a._style._tf.scaleX+l[1]+l[3]+c,E=a.height*a._style._tf.scaleY+l[0]+l[2],I=r.lineElement,A=A||L+C>y&&r.wordWrap,A&&i();H.elements.push(h),H.h=Math.max(H.h,E),h.x=L,h.y=T,L+=C,H.w=L-c,H.y=T,p=Math.max(L+m,p)}else N||(L+=t.DIV_ELEMENT_PADDING),H.wordStartIndex=H.elements.length;if(T=H.y+H.h,S){var U=0,b=y;for(o=0,d=M.length;d>o;o++)M[o].updatePos(0,b,o,U,w,v,_),U+=Math.max(_,M[o].h+f);T=U}for(g&&(e.width=p),T>e.height&&(e.height=T),o=0,d=M.length;d>o;o++)M[o].revertOrder(y);return[p,T]},t._will=null,t.DIV_ELEMENT_PADDING=0,t}(),x=function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}h(t,"laya.html.utils.LayoutLine");var e=t.prototype;return e.updatePos=function(t,e,i,n,h,r,l){var s,a=0;this.elements.length>0&&(s=this.elements[this.elements.length-1],a=s.x+s.width-this.elements[0].x);var o=0,d=0/0;1===h&&(o=(e-a)/2),2===h&&(o=e-a),0===l||0!=r||(r=1);for(var u=0,c=this.elements.length;c>u;u++){s=this.elements[u];var f=s._getCSSStyle();switch(0!==o&&(s.x+=o),f._getValign()){case 0:s.y=n;break;case 1:var _=0;99999!=this.minTextHeight&&(_=this.minTextHeight);var g=(_+l)/2;g=Math.max(g,this.h),d=s instanceof laya.html.dom.HTMLImageElement?n+g-s.height:n+g-s.height,s.y=d;break;case 2:s.y=n+(l-s.height)}}},e.revertOrder=function(t){var e;if(this.elements.length>0){var i=0,n=0;for(n=this.elements.length,i=0;n>i;i++)e=this.elements[i],e.x=t-e.x-e.width}},t}(),v=function(t){function e(){this.URI=null,this._href=null,e.__super.call(this),this._text=e._EMPTYTEXT,this.setStyle(new l(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}h(e,"laya.html.dom.HTMLElement",t);var n=e.prototype;return n.layaoutCallNative=function(){var t=0;if(this._childs&&(t=this._childs.length)>0)for(var e=0;t>e;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative();var i=this._getWords();i?laya.html.dom.HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},n.appendChild=function(t){return this.addChild(t)},n._getWords2=function(){var t=this._text.text;if(!t||0===t.length)return null;var e,i,n=0,h=0;if(this._text.drawWords)i=this._text.drawWords;else{for(e=t.split(" "),h=e.length-1,i=[],n=0;h>n;n++)i.push(e[n]," ");h>=0&&i.push(e[h]),this._text.drawWords=i}var r=this._text.words;if(r&&r.length===i.length)return r;null===r&&(this._text.words=r=[]),r.length=i.length;var l,s=this.style,o=s.font;for(n=0,h=i.length;h>n;n++){l=p.measureText(i[n],o);var d=r[n]=new a(i[n],l.width,l.height||s.fontSize,s);if(d.char.length>1&&(d.charNum=d.char),this.href){var u=new c;this.addChild(u),d.setSprite(u)}}return r},n._getWords=function(){if(!_.CharacterCache)return this._getWords2();var t=this._text.text;if(!t||0===t.length)return null;var e=this._text.words;if(e&&e.length===t.length)return e;null===e&&(this._text.words=e=[]),e.length=t.length;for(var i,n=this.style,h=n.font,r=0,l=t.length;l>r;r++){i=p.measureText(t.charAt(r),h),i||(console.error("getwords Error:"+i+" txt:"+t+" i:"+r+"charat(i):"+t.charAt(r)),i={width:0,height:0});var s=e[r]=new a(t.charAt(r),i.width,i.height||n.fontSize,n);if(this.href){var o=new c;this.addChild(o),s.setSprite(o)}}return e},n.showLinkSprite=function(){var t=this._text.words;if(t)for(var e,i,n=[],h=0;h<t.length;h++)i=t[h],e=new c,e.graphics.drawRect(0,0,i.width,i.height,"#ff0000"),e.width=i.width,e.height=i.height,this.addChild(e),n.push(e)},n._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(this._childs.length>0||null!=this._getWords())&&t.block?(w.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},n._setAttributes=function(e,i){switch(e){case"style":return this.style.cssText(i),void 0;case"class":return this.className=i,void 0}t.prototype._setAttributes.call(this,e,i)},n.updateHref=function(){if(null!=this._href){var t=this._getWords();if(t)for(var e,i,n=0;n<t.length;n++)e=t[n],i=e.getSprite(),i&&(i.size(e.width,e.height),i.on("click",this,this.onLinkHandler))}},n.onLinkHandler=function(t){switch(t.type){case"click":for(var e=this;e;)e.event("link",[this.href]),e=e.parent}},n.formatURL=function(t){return this.URI?y.formatURL(t,this.URI?this.URI.path:null):t},r(0,n,"href",function(){return this._href},function(t){this._href=t,null!=t&&(this._getCSSStyle().underLine=1,this.updateHref())}),r(0,n,"color",null,function(t){this.style.color=t}),r(0,n,"onClick",null,function(t){var e;i._runScript("fn=function(event){"+t+";}"),this.on("click",this,e)}),r(0,n,"id",null,function(t){L.document.setElementById(t,this)}),r(0,n,"innerTEXT",function(){return this._text.text},function(t){this.text=t}),r(0,n,"style",function(){return this._style}),r(0,n,"text",function(){return this._text.text},function(t){this._text==e._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),u.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),r(0,n,"parent",t.prototype._$get_parent,function(t){if(t instanceof laya.html.dom.HTMLElement){var e=t;this.URI||(this.URI=e.URI),this.style.inherit(e.style)}i.superSet(c,this,"parent",t)}),r(0,n,"className",null,function(t){this.style.attrs(L.document.styleSheets["."+t])}),e.fillWords=function(t,e,i,n,h,r,l){t.graphics.clear();for(var s=0,a=e.length;a>s;s++){var o=e[s];t.graphics.fillText(o.char,o.x+i,o.y+n,h,r,"left",l)}},e._EMPTYTEXT={text:null,words:null},e}(c),S=(function(t){function e(){e.__super.call(this),this.style.lineElement=!0,this.style.block=!0}return h(e,"laya.html.dom.HTMLBrElement",t),e}(v),function(t){function e(){this.contextHeight=0/0,this.contextWidth=0/0,e.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}h(e,"laya.html.dom.HTMLDivElement",t);var n=e.prototype;return n.appendHTML=function(t){m.parse(this,t,this.URI),this.layout()},n._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;e&&e.forEach(function(e){t.push(e)});for(var i=!0,n=0,h=this._childs.length;h>n;n++){var r=this._childs[n];i?i=!1:t.push(null),r._addToLayout(t)}return!0},n._addToLayout=function(){this.layout()},n.layout=function(){if(this.style){this.style._type|=512;var t=w.layout(this);if(t){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new d);var e=this._$P.mHtmlBounds;e.x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1],this.setBounds(e)}}},r(0,n,"height",function(){return this._height?this._height:this.contextHeight},t.prototype._$set_height),r(0,n,"innerHTML",null,function(t){this.destroyChildren(),this.appendHTML(t)}),r(0,n,"width",function(){return this._width?this._width:this.contextWidth},function(t){var e=!1;e=0===t?t!=this._width:t!=this.width,i.superSet(v,this,"width",t),e&&this.layout()}),e}(v)),L=function(t){function e(){this.all=new Array,this.styleSheets=l.styleSheets,e.__super.call(this)}h(e,"laya.html.dom.HTMLDocument",t);var i=e.prototype;return i.getElementById=function(t){return this.all[t]},i.setElementById=function(t,e){this.all[t]=e},n(e,["document",function(){return this.document=new e}]),e}(v);!function(t){function e(){this._tex=null,this._url=null,this._renderArgs=[],e.__super.call(this),this.style.block=!0}h(e,"laya.html.dom.HTMLImageElement",t);var i=e.prototype;return i._addToLayout=function(t){!this._style.absolute&&t.push(this)},i.render=function(t,e,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(f.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,t.ctx.drawTexture2(e,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},i.layaoutCallNative=function(){var t=0;if(this._childs&&(t=this._childs.length)>0)for(var e=0;t>e;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative()},r(0,i,"src",null,function(t){function e(){if(i._style){{var t=i._style;t.widthed(i)?-1:i._tex.width,t.heighted(i)?-1:i._tex.height}t.widthed(i)||i._width==i._tex.width||(i.width=i._tex.width,i.parent&&i.parent._layoutLater()),t.heighted(i)||i._height==i._tex.height||(i.height=i._tex.height,i.parent&&i.parent._layoutLater()),u.isConchApp&&(i._renderArgs[0]=i._tex,i._renderArgs[1]=i.x,i._renderArgs[2]=i.y,i._renderArgs[3]=i.width||i._tex.width,i._renderArgs[4]=i.height||i._tex.height,i.graphics.drawTexture(i._tex,0,0,i._renderArgs[3],i._renderArgs[4])),i.repaint(),i.parentRepaint()}}var i=this;if(t=this.formatURL(t),this._url!=t){this._url=t;var n=this._tex=o.getRes(t);n||(this._tex=n=new g,n.load(t),o.cacheRes(t,n)),n.loaded?e():n.on("loaded",null,e)}}),e}(v),function(t){function e(){this.type=null,e.__super.call(this),this.visible=!1}h(e,"laya.html.dom.HTMLLinkElement",t);var i=e.prototype;return i._onload=function(t){switch(this.type){case"text/css":l.parseCSS(t,this.URI)}},r(0,i,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t),this.URI=new y(t);var i=new o;i.once("complete",null,function(t){e._onload(t)}),i.load(t,"text")}),e._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g"),e}(v),function(t){function e(){e.__super.call(this),this.visible=!1}h(e,"laya.html.dom.HTMLStyleElement",t);var i=e.prototype;return r(0,i,"text",t.prototype._$get_text,function(t){l.parseCSS(t,null)}),e}(v),function(t){function e(){e.__super.call(this),this._getCSSStyle().valign="middle"}h(e,"laya.html.dom.HTMLIframeElement",t);var i=e.prototype;return r(0,i,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t);var i=new o;i.once("complete",null,function(i){var n=e.URI;e.URI=new y(t),e.innerHTML=i,!n||(e.URI=n)}),i.load(t,"text")}),e}(S)}}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});for(var i in Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}});